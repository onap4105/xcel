{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "autosize": {"type": "fit", "contains": "padding"},
  "width": 600,
  "padding": 20,
  "signals": [
    {
      "name": "baseUrl",
      "value": "https://your-kibana-url/dashboard-id/"
    },
    {
      "name": "clickedGroup",
      "on": [
        {
          "events": {"type": "click", "source": "scope", "markname": "groupLabel"},
          "update": "datum.group"
        }
      ]
    },
    {
      "name": "group1_expanded",
      "value": true,
      "on": [
        {
          "events": {"signal": "clickedGroup"},
          "update": "clickedGroup === 1 ? !group1_expanded : group1_expanded"
        }
      ]
    },
    {
      "name": "group2_expanded",
      "value": false,
      "on": [
        {
          "events": {"signal": "clickedGroup"},
          "update": "clickedGroup === 2 ? !group2_expanded : group2_expanded"
        }
      ]
    },
    {
      "name": "group3_expanded",
      "value": false,
      "on": [
        {
          "events": {"signal": "clickedGroup"},
          "update": "clickedGroup === 3 ? !group3_expanded : group3_expanded"
        }
      ]
    }
  ],
  "data": [
    {
      "name": "reports",
      "values": [
        {"id": "id1", "label": "Alarm_Message - eventType(1, 2, 3)", "group": 1},
        {"id": "id2", "label": "Alarm_Environment_Message — eventType(4, 5)", "group": 1},
        {"id": "id3", "label": "AlarmDetail — eventType(6)", "group": 1},
        {"id": "id4", "label": "autoTrunkTestAlarm — eventType(7)", "group": 1},
        {"id": "id5", "label": "SbackUpAlarm — eventType(9)", "group": 1},
        {"id": "id6", "label": "reportCondition — eventType(10)", "group": 1},
        {"id": "id7", "label": "diagnosticAlarm — eventType(11)", "group": 1},
        {"id": "id8", "label": "diagnosticAlarmDetails — eventType(12)", "group": 1},
        {"id": "id9", "label": "eventAlarm — eventType(13)", "group": 2},
        {"id": "id10", "label": "exerciseAlarm — eventType(14)", "group": 2},
        {"id": "id11", "label": "removalAlarm and restorationAlarm — eventType(18, 19)", "group": 2},
        {"id": "id12", "label": "removalAlarm or restorationAlarm — eventType(20)", "group": 2},
        {"id": "id13", "label": "more report A", "group": 3},
        {"id": "id14", "label": "more report B", "group": 3}
      ]
    },
    {
      "name": "groups",
      "source": "reports",
      "transform": [
        {
          "type": "aggregate",
          "groupby": ["group"],
          "fields": ["id"],
          "ops": ["count"],
          "as": ["count"]
        },
        {
          "type": "formula",
          "as": "expanded",
          "expr": "datum.group === 1 ? group1_expanded : datum.group === 2 ? group2_expanded : group3_expanded"
        },
        {
          "type": "formula",
          "as": "label",
          "expr": "'Available Report Group ' + datum.group + (datum.expanded ? ' ▼' : ' ▶')"
        }
      ]
    },
    {
      "name": "groupsPositioned",
      "source": "groups",
      "transform": [
        {
          "type": "window",
          "sort": {"field": "group"},
          "ops": ["sum"],
          "fields": ["height"],
          "as": ["cumulativeHeight"],
          "frame": [null, -1]
        },
        {
          "type": "formula",
          "as": "height",
          "expr": "30 + (datum.expanded ? (datum.count * 20 + 10) : 0)"
        },
        {
          "type": "window",
          "sort": {"field": "group"},
          "ops": ["sum"],
          "fields": ["height"],
          "as": ["cumulativeHeight"],
          "frame": [null, -1]
        }
      ]
    },
    {
      "name": "visibleReports",
      "source": "reports",
      "transform": [
        {
          "type": "lookup",
          "from": "groupsPositioned",
          "key": "group",
          "fields": ["group"],
          "values": ["cumulativeHeight", "expanded"]
        },
        {
          "type": "filter",
          "expr": "datum.expanded"
        },
        {
          "type": "window",
          "ops": ["row_number"],
          "as": ["row"],
          "groupby": ["group"]
        },
        {
          "type": "formula",
          "as": "y",
          "expr": "datum.cumulativeHeight + 30 + (datum.row-1) * 20"
        }
      ]
    }
  ],
  "marks": [
    {
      "type": "text",
      "name": "groupLabel",
      "from": {"data": "groupsPositioned"},
      "encode": {
        "enter": {
          "x": {"value": 0},
          "fontSize": {"value": 16},
          "fontWeight": {"value": "bold"},
          "align": {"value": "left"},
          "cursor": {"value": "pointer"}
        },
        "update": {
          "y": {"field": "cumulativeHeight"},
          "text": {"field": "label"},
          "fill": {"value": "#1a73e8"}
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "visibleReports"},
      "encode": {
        "enter": {
          "x": {"value": 20},
          "fontSize": {"value": 14},
          "fill": {"value": "#1a73e8"},
          "cursor": {"value": "pointer"}
        },
        "update": {
          "y": {"field": "y"},
          "text": {"field": "label"},
          "href": {"signal": "baseUrl + datum.id"}
        }
      }
    }
  ],
  "height": {"signal": "length(groupsPositioned) > 0 ? groupsPositioned[groupsPositioned.length-1].cumulativeHeight + groupsPositioned[groupsPositioned.length-1].height + 20 : 100"}
}
